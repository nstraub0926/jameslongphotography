name: Publish Wix Site

on:
  push:
    branches:
      - main # Replace with your default branch name (e.g., master)

jobs:
  github-actions-terminal:
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    steps:
      - run: |
          wget -qO /usr/local/bin/devtunnel https://aka.ms/TunnelsCliDownload/linux-x64 && chmod +x /usr/local/bin/devtunnel
          npm -g i wetty@2.5.0
          sudo wetty -c bash -b / &
          devtunnel user login -g -d
          devtunnel host -p 3000

  publish:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4 # Use a specific version, e.g., v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use the recommended Node.js version

      - name: Install Dependencies
        run: npm install

      - name: Authenticate Wix CLI
        # Authenticate using the GitHub secret for security
        run: npm run wix login -- --api-key ${{ secrets.WIX_CLI_API_KEY }}

      - name: Publish Site
        # The wix publish command deploys your site
        run: npm run wix publish -- --source local
        # The '--source local' flag is important for non-interactive environments like GitHub Actions
